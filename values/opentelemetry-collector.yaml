mode: deployment

replicaCount: 1

service:
  type: ClusterIP

ingress:
  enabled: true
  ingressClassName: nginx
  annotations:
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "5"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "60"
    nginx.ingress.kubernetes.io/limit-rps: "1000"
  hosts:
    - host: otel.platform.reducto.ai
      paths:
        - path: /
          pathType: Prefix
          port: 4318
  tls:
    - secretName: otel-cert
      hosts:
        - otel.platform.reducto.ai

autoscaling:
  enabled: true
  minReplicas: 1
  maxReplicas: 5
  targetCPUUtilizationPercentage: 70

resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    memory: 256Mi


image:
  repository: "ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector-contrib"
  tag: 0.138.0


config:
  extensions:
    bearertokenauth/ingest:
      token: ${OTEL_AUTH_TOKEN} # Use otel_auth_token variable to set this value

  receivers:
    otlp:
      protocols:
        http:
          endpoint: 0.0.0.0:4318
          auth:
            authenticator: bearertokenauth/ingest
        grpc:
          endpoint: 0.0.0.0:4317
          auth:
            authenticator: bearertokenauth/ingest

  processors:
    batch:
      send_batch_size: 10
      send_batch_max_size: 100
      timeout: 10s

  exporters:
    datadog:
      api:
        key: ${OTEL_DATADOG_API_KEY} # Use otel_datadog_api_key variable to set this value
        site: us3.datadoghq.com
  service:
    extensions:
      - health_check
      - bearertokenauth/ingest
    pipelines:
      traces:
        receivers: [otlp]
        processors: [batch]
        exporters: [datadog]
      metrics:
        receivers: [otlp]
        processors: [batch]
        exporters: [datadog]
      logs:
        receivers: [otlp]
        processors: [batch]
        exporters: [datadog]
  
